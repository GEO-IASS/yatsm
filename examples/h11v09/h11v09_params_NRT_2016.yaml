# Example configuration file for YATSM line runner
#
# This configuration includes details about the dataset and how YATSM should
# run

# Version of config
version: "0.5.0"

dataset:
    # Text file containing dates and images
    input_file: "/projectnb/landsat/datasets/MODIS/h11v09/monitor/h11v09_submit_NRT_2016.csv"
    # Input date format
    date_format: "%Y%j"
    # Output location
    output: "/projectnb/landsat/datasets/MODIS/h11v09/monitor/YATSM"
    # Output file prefix (e.g., [prefix]_[line].npz)
    output_prefix: "yatsm_r"
    # Total number of bands
    n_bands: 7
    # Mask band (e.g., Fmask)
    mask_band: 6
    # List of integer values to mask within the mask band
    mask_values: [0, -9999]
    # Valid range of non-mask band data
    # specify 1 range for all bands, or specify ranges for each band
    min_values: -1000
    max_values: 100000
    # Indices for multi-temporal cloud masking (indexed on 1)
    green_band: 4
    swir1_band: 5
    # Use BIP image reader? If not, use GDAL to read in
    use_bip_reader: False
    # Directory location for caching dataset lines
    cache_line_dir: "/projectnb/landsat/datasets/MODIS/h11v09/stacks/.NRTcache2016"

# Parameters common to all timeseries analysis models within YATSM package
YATSM:
    algorithm: "CCDCesque"
    output: "/projectnb/landsat/datasets/MODIS/h11v09/monitor/YATSM"
    # Output file prefix (e.g., [prefix]_[line].npz)
    output_prefix: "yatsm_r"
    prediction: "GLMNET_Lasso20"
    design_matrix: "1 + x + harm(x, 1)"
    reverse: False
    commission_alpha:
    # Re-fit each segment, adding new coefficients & RMSE info to record
    refit:
        prefix: [robust]
        prediction: [RLM]

# Parameters for CCDCesque algorithm -- referenced by "algorithm" key in YATSM
CCDCesque:
    consecutive: 5
    threshold: 3.5
    min_obs: 16
    min_rmse: 100
    test_indices: [0]
    retrain_time: 365.25
    screening: RLM
    screening_crit: 600.0
    slope_test: True
    remove_noise: True
    dynamic_rmse: False

# Regression estimators
LassoCV:
    pickle: "/projectnb/landsat/users/bullocke/yatsm_newest/yatsm_NRT/yatsm/examples/regression/LassoCV_n100_alpha_0-50.pkl"

Lasso20:
    pickle: "/projectnb/landsat/users/bullocke/yatsm_newest/yatsm_NRT/yatsm/examples/regression/Lasso_alpha20.pkl"

OLS:
    pickle: "/projectnb/landsat/users/bullocke/yatsm_newest/yatsm_NRT/yatsm/examples/regression/OLS.pkl"

GLMNET_LassoCV:
    pickle: "/projectnb/landsat/users/bullocke/yatsm_newest/yatsm_NRT/yatsm/examples/regression/glmnet_LassoCV_n50_lambda_0-35.pkl"

GLMNET_Lasso20:
    pickle: "/projectnb/landsat/users/bullocke/yatsm_newest/yatsm_NRT/yatsm/examples/regression/glmnet_Lasso_lambda_20.pkl"

RLM:
    pickle: "/projectnb/landsat/users/bullocke/yatsm_newest/yatsm_NRT/yatsm/examples/regression/rlm_maxiter10.pkl"

# Section for phenology fitting
phenology:
    enable: False
    # Specification for dataset indices required for EVI based phenology monitoring
    red_index: 2
    nir_index: 3
    blue_index: 0
    # Scale factor for reflectance bands
    scale: 0.0001
    # You can also specify index of EVI if contained in dataset to override calculation
    evi_index:
    evi_scale:
    # Number of years to group together when normalizing EVI to upper and lower percentiles
    year_interval: 3
    # Upper and lower percentiles of EVI used for max/min scaling
    q_min: 10
    q_max: 90

# Section for segmentation
segment:
    # Segmentation image
    segmentation:
    # Resegmentation threshold (0 turns off resegmentation)
    resegment_crit: 0
    # Resegmentation size thresholds
    resegment_minpix: 5
    resegment_maxpix: 50

NRT:
    download_directory: /projectnb/landsat/datasets/MODIS/h11v09/download/2016
    stack_directory: /projectnb/landsat/datasets/MODIS/h11v09/stacks/2016/
    output_directory: /projectnb/landsat/datasets/MODIS/h11v09/stacks/2016/Composites
    tile: h11v09
    view_angle_band: 7 #put mask band if Landsat
    view_angle_threshold: 35
    monitor_list: "list.csv" #location of list of images to monitor 
    low_conf: 2 #Low confidence in change
    med_conf: 4 #Medium confidence in change
    high_conf: 6 #high confidence in change. Should = consecutive 
    monitor_log_dir: '/projectnb/landsat/datasets/MODIS/h11v09/monitor/logs'
    rmse_threshold: 600
    ndvi_threshold: 8000
    slope_threshold: 1

# Section for training and classification
classification:
    # Training data file
    training_image: "/projectnb/landsat/datasets/MODIS/h11v09/training/ROIs.tif"
    # Training data masked values
    roi_mask_values: [0, 255]
    # Date range
    training_start: "2011-01-01"
    training_end: "2012-01-01"
    training_date_format: "%Y-%m-%d"
    # Cache X feature input and y labels for training data image into file?
    cache_training:
